<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Per Date</title>
    <script type="text/javascript"
            src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript"
            src="{% static 'js/moment.min.js' %}"></script>
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/bootstrap.css' %}"/>

    <!-- Include Date Range Picker -->
    <script type="text/javascript"
            src="{% static 'js/daterangepicker.js' %}"></script>
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/daterangepicker.css' %}"/>


    <script src="https://cdn.anychart.com/js/7.12.0/anychart-bundle.min.js"></script>
    <link rel="stylesheet"
          href="https://cdn.anychart.com/css/7.12.0/anychart-ui.min.css"/>
    <style>
        html, body, #container, #other_container, #my_container {
            width: 100%;
            height: 95%;
            margin: 0;
            padding: 1px 1px 1px 80px;
        }

        #my {
            padding: 11px 1px 1px 90px;
        }
    </style>
</head>
<body>

<!-- Include Required Prerequisites -->


<div id="my">

    <a type = "button" class = "btn btn-info" href="/">Home</a> <br>
    <div id="reportrange" class="pull-left"
         style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 45%">
        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
        <span></span> <b class="caret"></b>
    </div>
    <br>
    <form action="/dates" method="post" id="the_form">
        {% csrf_token %}
        <input id="id_subject" type="text" name="subject" maxlength="500" hidden/>
        <input type="submit" value="Submit" class="btn btn-success"/>
    </form>


</div>

<div id="my_container"></div>
{% if vendors %}
    <button onclick="change_graphic()" id="my_btn">View in graph</button>
{% endif %}
<div id="container"></div>
<div id="other_container" hidden></div>



<script type="text/javascript">


    anychart.onDocumentReady(function () {
        {% if daily_info %}
            var data1 = anychart.data.set([

                {% for my_info in daily_info %}
                    ["{{ my_info.0 }}", {{ my_info.1 }}, {{ my_info.2 }}],
                {% endfor %}
            ]);


            var transactions = data1.mapAs({x: [0], value: [1]});
            var total_expense = data1.mapAs({x: [0], value: [2]});

            chart = anychart.column();

            chart.title("Daily Expenditure between {{ start }} and {{ end }}");

            // series data
            chart.column(transactions);
            chart.column(total_expense);

            // adjusting axes labels
            var xLabels = chart.yAxis().labels();
            xLabels.rotation(-90);
            xLabels.padding(0, 5, 0, 5);
            var yLabels = chart.xAxis().labels();
            yLabels.rotation(-90);
            yLabels.padding(5, 0, 5, 0);

            chart.container("my_container");
            chart.draw();
        {% endif %}

        {% if vendors %}
            chart = anychart.pie3d([
                {% for v in vendors %}
                    {name: "{{ v.0 }} ", value: {{ v.1 }}},
                {% endfor %}
            ]);


            // draw
            chart.title("{{ title }}");
            chart.container("container");
            chart.draw();

            var data = anychart.data.set([
                {% for v in vendors %}
                    ["{{ v.0 }} ", {{ v.1 }}],
                {% endfor %}
            ]);

            // set chart type
            other_chart = anychart.bar3d();

            // setting title
            other_chart.title("{{ title }}");

            // enabled grids
            other_chart.grid(0).enabled(true);
            other_chart.grid(1).enabled(true).layout("horizontal");

            // set axes titles
            var xAxis = other_chart.xAxis();
            xAxis.title("Vendors");
            var yAxis = other_chart.yAxis();
            yAxis.title("Total");

            // set data
            var series = other_chart.bar(data);
            series.name("Total");

            // draw chart
            other_chart.container("other_container");
            other_chart.draw();
        {% endif %}


    });


    function change_graphic() {
        var graph = document.getElementById("other_container");
        var pie = document.getElementById("container");
        var btn = document.getElementById("my_btn");
        if (graph.hidden) {
            graph.hidden = false;
            pie.hidden = true;
            btn.textContent = "View in Pie Chart";
        } else if (pie.hidden) {
            graph.hidden = true;
            pie.hidden = false;
            btn.textContent = "View in Graph";
        }
    }
    $(function () {

        var start = moment("{{ start }}"); // moment().subtract(29, 'days');
        var end = moment("{{ end }}");

        function cb(start, end) {
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            document.getElementById('id_subject').value = start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY');
{#            $('#my_thing input').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));#}
        }

        $('#reportrange').daterangepicker({
            startDate: start,
            endDate: end,
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);

        cb(start, end);

    });
</script>


</body>
</html>
